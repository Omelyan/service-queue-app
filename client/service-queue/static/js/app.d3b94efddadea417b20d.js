webpackJsonp([1],{"2qlL":function(e,t){},"4+hh":function(e,t){},"7zck":function(e,t){},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("7+uW"),s=i("3EgV"),a=i.n(s),r={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var u=i("VU/8")({name:"Service-Queue-Display"},r,!1,function(e){i("OLtA")},null,null).exports,o=i("/ocq"),c=i("Xxa5"),d=i.n(c),l=i("exGp"),p=i.n(l),f=i("INCx"),h=i.n(f),m=i("BO1k"),v=i.n(m),g=i("pFYg"),b=i.n(g),w={props:{state:String,symbol:Number,swinging:Boolean,blinking:Boolean,deadline:{type:Date,required:!0},left:{type:Number,required:!0},plate:{type:String,required:!0}},computed:{label:function(){switch(this.state){case"success":return"виконано";case"postponed":return"відкладено";case"error":return"скасовано";default:return this.left<15?"завершення робіт":null}},hours:function(){return h()(this.left/60)},minutes:function(){return this.left%60},units:function(){return this.hours?"год":"хв"},deadlineHours:function(){return String("0"+this.deadline.getHours()).slice(-2)},deadlineMinutes:function(){return String("0"+this.deadline.getMinutes()).slice(-2)}}},y={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("li",[i("div",{class:["countdown",{status:e.label}]},[e.symbol&&!e.label?i("span",{staticClass:"symbol",on:{animationend:function(t){e.$emit("update:symbol",0)}}},[e._v(e._s(String.fromCharCode(e.symbol)))]):e._e(),e.label?i("span",{class:["label",e.state]},[e._v(e._s(e.label))]):i("span",{class:["timer",{blinking:e.blinking}],on:{animationend:function(t){e.$emit("update:blinking",!1)}}},[e.left>60?i("span",{staticClass:"deadline"},[i("span",{staticClass:"hours"},[e._v(e._s(e.deadlineHours))]),i("span",{staticClass:"minutes"},[i("span",{staticClass:"colon"}),e._v(e._s(e.deadlineMinutes))])]):i("span",[e.hours?i("span",{staticClass:"hours"},[e._v(e._s(e.hours))]):e._e(),e.minutes?i("span",{staticClass:"minutes"},[e.hours?i("span",{staticClass:"colon"}):e._e(),e._v(e._s(String("0"+e.minutes).slice(-2)))]):e._e(),e.hours*e.minutes?e._e():i("span",{staticClass:"units"},[e._v(" "+e._s(e.units))])])])]),i("div",{class:["plate md-elevation-6",{swinging:e.swinging}],on:{animationend:function(t){e.$emit("update:swinging",!1)}}},[e._v(e._s(e.plate))])])},staticRenderFns:[]};var q=i("VU/8")(w,y,!1,function(e){i("Poss")},"data-v-8751ba82",null).exports,A=i("mtWM"),_=i.n(A),k={serverURL:document.location.protocol+"//"+document.location.hostname,serverPort:3005,ticksInterval:15e3,sanitizeAfterTC:40,startAdsAfterTC:60,videoWaitingTime:9e3},C=_.a.create({baseURL:k.serverURL+":"+k.serverPort+"/"}),T={getVideoSourceURL:function(){var e=this;return p()(d.a.mark(function t(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C.defaults.baseURL+"queue/video");case 1:case"end":return e.stop()}},t,e)}))()},getUpdatesAfter:function(e,t){C.get("queue/updatesAfter/"+e).then(function(e){switch(e.status){case 200:t(e.data);break;case 204:break;case 205:document.location.reload(!0)}}).catch(function(){})}},S=i("9qgI"),I=i.n(S),Q={components:{QueuedItem:q},props:{ticksInterval:{type:Number,default:5e3},sanitizeAfterTC:{type:Number,default:60},startAdsAfterTC:{type:Number,default:60},videoWaitingTime:{type:Number,default:6e3}},data:function(){return{queue:[],queueIsDeprecated:!1,showQueue:!1,showAds:!0,timer:null,sanitizeTC:0,startAdsTC:0,updatedStamp:0,videoSourceURL:"",videoTimeout:null,screenFactor:16,offset:0,time:{now:0,hours:0,minutes:0}}},computed:{queueSlice:function(){return this.queueIsDeprecated?[]:this.queue.slice(0,12)},timeString:function(){return String("0"+this.time.hours).slice(-2)+" "+String("0"+this.time.minutes).slice(-2)}},methods:{update:function(e){var t=this,i=e.items,n=void 0===i?[]:i,s=e.timeStamp,a=void 0===s?0:s,r=function(e,i,n){t.queue.splice(e,i,{id:n.id,left:n.left,state:n.state,plate:n.plate,symbol:n.symbol,updated:n.updated,deadline:new Date(n.updated+6e4*n.left),swinging:!0,blinking:!0})},u=this.queue[0],o=!1;this.updatedStamp=a;for(var c=function(e){var i=t.queue[e],s=n.findIndex(function(e){return e.id===i.id});if(s+1)r(e,1,n[s]),n.splice(s,1);else if(0===n.length)return{v:void 0};o=o||t.compare(i,u)<0,u=i},d=0;d<this.queue.length;d++){var l=c(d);if("object"===(void 0===l?"undefined":b()(l)))return l.v}o&&this.queue.sort(this.compare);var p=!0,f=!1,h=void 0;try{for(var m,g=v()(n);!(p=(m=g.next()).done);p=!0){var w=m.value;for(d=0;d<this.queue.length&&this.compare(this.queue[d],w)<0;d++);r(d,0,w)}}catch(e){f=!0,h=e}finally{try{!p&&g.return&&g.return()}finally{if(f)throw h}}},compare:function(e,t){var i=this.calculate(e),n=this.calculate(t);return(i-n)*(1-2*(i<0&&n<0))},calculate:function(e){return e.left-h()((this.time.now-e.updated)/6e4)},beforeEnterQueue:function(e){e.style.opacity=0},enterQueue:function(e,t){var i=.2*e.dataset.index*1e3;I()(e,{opacity:1},{delay:i,duration:1e3,complete:function(){e.classList.add("on"),t()}})},leaveQueue:function(e,t){var i=.2*e.dataset.reverseIndex*1e3;e.classList.remove("on"),!1===this.queueIsDeprecated&&(e.style.position="absolute",i=0),I()(e,{opacity:0},{delay:i,duration:1/3*1e3,complete:t})},sanitize:function(){for(var e=this.queue.length;e--;){var t=this.queue[e];(this.calculate(t)<-30||"error"===t.state)&&this.queue.splice(e,1)}0===this.queue.length&&this.startAds()},startAds:function(){var e=this;return p()(d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.getVideoSourceURL();case 3:e.videoSourceURL=t.sent,t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(0),e.stopAds(),new Error("Cannot get a video source ("+t.t0+").");case 10:e.videoWaiting(),e.queueIsDeprecated=!0,setTimeout(function(){e.showQueue=!1},0);case 13:case"end":return t.stop()}},t,e,[[0,6]])}))()},stopAds:function(){var e=this;this.offset=Math.random(),this.showAds=!1,this.showQueue=!0,setTimeout(function(){e.queueIsDeprecated=!1},0)},videoPlaying:function(){clearTimeout(this.videoTimeout)},videoWaiting:function(){clearTimeout(this.videoTimeout),this.videoTimeout=setTimeout(this.stopAds,this.videoWaitingTime)},videoEnded:function(e){if(this.queue.length>0)return this.stopAds();try{this.startAds()}catch(e){throw new Error("Unable to start a video ("+e+").")}e.target.play()},ticktock:function(){var e=new Date;this.time.now=e.getTime(),this.time.hours=e.getHours(),this.time.minutes=e.getMinutes(),this.sanitizeTC+=1,this.showQueue&&(this.startAdsTC+=1,this.startAdsTC%this.startAdsAfterTC==0&&this.startAds()),this.sanitizeTC%this.sanitizeAfterTC==0&&this.sanitize(),T.getUpdatesAfter(this.updatedStamp,this.update)}},mounted:function(){this.screenFactor=Math.round(window.innerWidth/42),this.timer=setInterval(this.ticktock,this.ticksInterval),this.startAds()}},x={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-app",{attrs:{id:"service-queue",dark:""}},[i("v-content",{class:{rainbow:e.showQueue},style:"--screen-factor: "+e.screenFactor+"; --offset: "+e.offset},[e.showAds?i("div",{attrs:{id:"ads"}},[i("video",{attrs:{src:e.videoSourceURL,type:"video/mp4",muted:"",autoplay:""},domProps:{muted:!0},on:{playing:e.videoPlaying,waiting:e.videoWaiting,error:e.videoWaiting,ended:e.videoEnded}})]):e._e(),i("transition",{attrs:{type:"transition",name:"slide-from-top"}},[e.showQueue?i("span",{staticClass:"md-elevation-3",attrs:{id:"clock"}},[e._v(e._s(e.timeString))]):e._e()]),i("transition",{attrs:{type:"transition",name:"fade"},on:{"after-leave":function(t){e.showAds=!0}}},[e.showQueue?i("div",{attrs:{id:"queue"}},[i("transition-group",{attrs:{name:"queued-item",tag:"ul",css:!1},on:{"before-enter":e.beforeEnterQueue,enter:e.enterQueue,leave:e.leaveQueue}},e._l(e.queueSlice,function(t,n){return i("queued-item",{key:t.id,staticClass:"queued-item",attrs:{"data-index":n,"data-reverse-index":e.queueSlice.length-n-1,state:t.state,symbol:t.symbol,swinging:t.swinging,blinking:t.blinking,deadline:t.deadline,left:e.calculate(t),plate:t.plate},on:{"update:symbol":function(i){e.$set(t,"symbol",i)},"update:swinging":function(i){e.$set(t,"swinging",i)},"update:blinking":function(i){e.$set(t,"blinking",i)}}})}))],1):e._e()])],1)],1)},staticRenderFns:[]};var L=i("VU/8")(Q,x,!1,function(e){i("2qlL")},"data-v-393835bb",null).exports;n.default.use(o.a);var U,z=i("IHMs"),R=i.n(z),W={primary:R.a.blue.accent4,secondary:R.a.deepPurple.base,accent:R.a.pink.accent3,error:R.a.red.base,warning:R.a.amber.darken3,info:"#111",success:"#008500"};i("7zck"),i("4+hh");n.default.use(a.a,{options:{customProperties:!0},theme:W}),new n.default({el:"#app",router:(U=k,new o.a({routes:[{path:"/queue",name:"queue",component:L,props:function(){return{ticksInterval:U.ticksInterval,sanitizeAfterTC:U.sanitizeAfterTC,startAdsAfterTC:U.startAdsAfterTC,videoWaitingTime:U.videoWaitingTime}}}]})),components:{"Service-Queue-Display":u},template:"<Service-Queue-Display/>"})},OLtA:function(e,t){},Poss:function(e,t){}},["NHnr"]);